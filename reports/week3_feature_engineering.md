# Week 3 — Feature Engineering (Updated)

**Input**: `ncr_ride_bookings_cleaned.csv`  
**Rows (after time guards & re-dedup)**: 148,767

## Revenue (row-level)
- Saved: `ncr_rowlevel_revenue_full.csv`, `ncr_rowlevel_revenue_model.csv` (rows: 148,767)
- Numeric features: ['Ride Distance', 'Avg VTAT', 'Avg CTAT', 'Hour', 'price_per_km', 'speed_proxy']
- Added flags: `is_weekend`, `rush_am`, `rush_pm`
- One-hot: Vehicle Type / Weekday → 15 columns
- Engineered: `price_per_km`, `speed_proxy` (safe divide)

**Preview (`rev_model`)**
|   Ride Distance |   Avg VTAT |   Avg CTAT |   Hour |   price_per_km |   speed_proxy |   Booking Value | Date_parsed         |
|----------------:|-----------:|-----------:|-------:|---------------:|--------------:|----------------:|:--------------------|
|           38.69 |        3.8 |       20.1 |     18 |        3.6702  |      1.92488  |             142 | 2024-01-01 00:00:00 |
|           26.14 |        7.5 |       33.2 |     18 |       23.5654  |      0.787349 |             616 | 2024-01-01 00:00:00 |
|           23.72 |        7.8 |       28.8 |     17 |       17.4536  |      0.823611 |             414 | 2024-01-01 00:00:00 |
|           36.6  |       11.7 |       18.1 |     20 |       20.1913  |      2.0221   |             739 | 2024-01-01 00:00:00 |
|           23.72 |        3.4 |       28.8 |      5 |       17.4536  |      0.823611 |             414 | 2024-01-01 00:00:00 |
|           31.04 |        2.2 |       21.7 |     19 |        4.73582 |      1.43041  |             147 | 2024-01-01 00:00:00 |
|           41.48 |       13.8 |       35.7 |     17 |        7.32883 |      1.1619   |             304 | 2024-01-01 00:00:00 |
|           23.23 |        2.8 |       26   |     16 |       18.6827  |      0.893462 |             434 | 2024-01-01 00:00:00 |

## Demand (daily)
- Saved: `ncr_daily_demand_soft.csv` (soft), `ncr_daily_demand_hard.csv` (hard)
- Added: lags (1/7/14), rolls (7/14/28), **roll_std_7/14**, **sin_7/cos_7** weekly seasonality
- Contiguous daily index via `asfreq('D')`

**Preview (`daily_hard`)**
| Date_parsed         |   rides |   revenue |   Weekday_num |   Month |   lag_1 |   lag_7 |   lag_14 |   roll_7 |   roll_14 |   roll_28 |   roll_std_7 |   roll_std_14 |        sin_7 |     cos_7 |   rev_lag_1 |   rev_lag_7 |   rev_lag_14 |   rev_roll_7 |   rev_roll_14 |   rev_roll_28 |
|:--------------------|--------:|----------:|--------------:|--------:|--------:|--------:|---------:|---------:|----------:|----------:|-------------:|--------------:|-------------:|----------:|------------:|------------:|-------------:|-------------:|--------------:|--------------:|
| 2024-01-15 00:00:00 |     407 |    227523 |             0 |       1 |     421 |     387 |      410 |  413.143 |   407.714 |   407.867 |     16.5874  |       18.3698 | -4.89859e-16 |  1        |      236410 |      158495 |       180053 |       197069 |        193150 |        192276 |
| 2024-01-16 00:00:00 |     433 |    178056 |             1 |       1 |     407 |     428 |      384 |  413.857 |   411.214 |   409.438 |     17.4206  |       18.1709 |  0.781831    |  0.62349  |      227523 |      184834 |       164896 |       196100 |        194090 |        191388 |
| 2024-01-17 00:00:00 |     410 |    166874 |             2 |       1 |     433 |     404 |      382 |  414.714 |   413.214 |   409.471 |     16.9972  |       16.1349 |  0.974928    | -0.222521 |      178056 |      171069 |       163563 |       195501 |        194326 |        189946 |
| 2024-01-18 00:00:00 |     416 |    176745 |             3 |       1 |     410 |     433 |      409 |  412.286 |   413.714 |   409.833 |     15.0523  |       16.1027 |  0.433884    | -0.900969 |      166874 |      177178 |       169350 |       195439 |        194854 |        189212 |
| 2024-01-19 00:00:00 |     426 |    179763 |             4 |       1 |     416 |     384 |      415 |  418.286 |   414.5   |   410.684 |      9.08688 |       16.4352 | -0.433884    | -0.900969 |      176745 |      158334 |       186627 |       198501 |        194364 |        188715 |
| 2024-01-20 00:00:00 |     433 |    240110 |             5 |       1 |     426 |     415 |      403 |  420.857 |   416.643 |   411.8   |     10.4471  |       16.7727 | -0.974928    | -0.222521 |      179763 |      224133 |       229424 |       200783 |        195127 |        191285 |
| 2024-01-21 00:00:00 |     447 |    242827 |             6 |       1 |     433 |     421 |      436 |  424.571 |   417.429 |   413.476 |     14.3858  |       17.9646 | -0.781831    |  0.62349  |      240110 |      236410 |       252258 |       201700 |        194454 |        193739 |
| 2024-01-22 00:00:00 |     377 |    159731 |             0 |       1 |     447 |     407 |      387 |  420.286 |   416.714 |   411.818 |     22.6106  |       19.4083 | -7.34788e-16 |  1        |      242827 |      227523 |       158495 |       192015 |        194542 |        192193 |

## Notes
- Week 4 can now use:
  - Demand: RF/XGB with lags/rolls **and** volatility + seasonal terms.
  - Revenue: Linear (log target) vs RF/XGB; importances expected to emphasize distance, VTAT/CTAT, hour/peaks.